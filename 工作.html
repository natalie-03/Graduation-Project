<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工作心得交流</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3.layout.cloud.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS 保持不變 */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        
        :root {
            --primary: #4a6fa5; --secondary: #6b8cbc; --accent: #ff6b6b; --light: #f8f9fa;
            --dark: #343a40; --gray: #6c757d; --light-gray: #e9ecef; --success: #28a745;
            --interview: #6a5acd; --discuss: #20b2aa;
        }
        
        body { background: linear-gradient(135deg, #f5f7fa 0%, #e4e7eb 100%); color: var(--dark); line-height: 1.6; }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white; padding: 20px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-radius: 0 0 15px 15px; margin-bottom: 30px;
        }
        
        .header-content { display: flex; justify-content: space-between; align-items: center; padding: 0 20px; }
        
        .logo { display: flex; align-items: center; gap: 15px; }
        .logo i { font-size: 2.2rem; color: #ffd43b; }
        .logo h1 { font-size: 1.8rem; font-weight: 700; }
        
        .nav-links { display: flex; gap: 25px; }
        .nav-links a {
            color: white; text-decoration: none; font-weight: 500; padding: 8px 15px;
            border-radius: 30px; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px;
        }
        .nav-links a:hover, .nav-links a.active { background-color: rgba(255, 255, 255, 0.2); }
        
        .search-bar { display: flex; gap: 10px; max-width: 500px; width: 100%; }
        .search-bar input { flex: 1; padding: 12px 20px; border: none; border-radius: 50px; font-size: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .search-bar button {
            background-color: var(--accent); color: white; border: none; border-radius: 50px;
            padding: 12px 25px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 8px;
        }
        .search-bar button:hover { background-color: #ff5252; transform: translateY(-2px); }
        
        .hero-section {
            background: linear-gradient(135deg, rgba(106, 90, 205, 0.9), rgba(32, 178, 170, 0.9));
            border-radius: 20px; padding: 40px; margin-bottom: 40px; color: white;
            display: flex; flex-direction: column; align-items: center; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .hero-section h2 { font-size: 2.5rem; margin-bottom: 15px; max-width: 800px; }
        .hero-section p { font-size: 1.2rem; margin-bottom: 25px; max-width: 700px; opacity: 0.9; }
        
        .stats-cards { display: flex; gap: 20px; margin-top: 20px; flex-wrap: wrap; justify-content: center; }
        .stat-card {
            background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border-radius: 15px;
            padding: 20px; min-width: 180px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .stat-card .number { font-size: 2.2rem; font-weight: 700; margin-bottom: 5px; }
        .stat-card .label { font-size: 1rem; opacity: 0.9; }
        
        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 40px; }
        @media (max-width: 992px) { .main-content { grid-template-columns: 1fr; } }
        
        .section-title {
            display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;
            padding-bottom: 10px; border-bottom: 2px solid var(--light-gray);
        }
        .section-title h2 { font-size: 1.5rem; color: var(--interview); display: flex; align-items: center; gap: 10px; }
        .section-title h2 i { background-color: rgba(106, 90, 205, 0.1); padding: 8px; border-radius: 10px; color: var(--interview); }
        
        .filters { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 25px; }
        .filter-btn {
            background-color: white; border: 1px solid var(--light-gray); padding: 8px 16px; border-radius: 50px;
            cursor: pointer; transition: all 0.2s ease; font-size: 0.9rem; display: flex; align-items: center; gap: 5px;
        }
        .filter-btn:hover, .filter-btn.active { background-color: var(--interview); color: white; border-color: var(--interview); }
        
        .tab-container { display: flex; margin-bottom: 20px; background-color: white; border-radius: 50px; padding: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .tab { flex: 1; text-align: center; padding: 10px; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; }
        .tab.active { background-color: var(--interview); color: white; }
        
        .interview-list { background-color: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); padding: 25px; height: 650px; overflow-y: auto; }
        .interview-list::-webkit-scrollbar { width: 8px; }
        .interview-list::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .interview-list::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 10px; }
        .interview-list::-webkit-scrollbar-thumb:hover { background: var(--interview); }
        
        .interview-card {
            background-color: white; border-radius: 12px; padding: 20px; margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05); border-left: 4px solid var(--interview);
            transition: all 0.3s ease;
        }
        .interview-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .interview-card.discussion { border-left: 4px solid var(--discuss); }
        .interview-card h3 { font-size: 1.2rem; margin-bottom: 8px; color: var(--dark); }
        
        .interview-meta { display: flex; flex-wrap: wrap; gap: 15px; margin: 15px 0; color: var(--gray); font-size: 0.9rem; }
        .interview-meta span { display: flex; align-items: center; gap: 5px; }
        
        .interview-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px; }
        .tag { background-color: var(--light-gray); padding: 5px 12px; border-radius: 50px; font-size: 0.8rem; }
        
        .analytics-section { display: grid; grid-template-columns: 1fr; gap: 25px; }
        
        .wordcloud-container, .chart-container {
            background-color: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 25px; height: 300px; position: relative;
        }
        
        .chart-center-label {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; font-weight: bold; color: var(--dark); pointer-events: none;
        }
        .chart-center-label .main { font-size: 1.2rem; margin-bottom: 5px; }
        .chart-center-label .sub { font-size: 0.9rem; color: var(--gray); }
        
        .chart-row { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        @media (max-width: 768px) { .chart-row { grid-template-columns: 1fr; } }
        
        footer {
            text-align: center; margin-top: 40px; padding: 30px 20px; color: var(--gray); font-size: 0.9rem;
            border-top: 1px solid var(--light-gray); background-color: white; border-radius: 15px 15px 0 0;
        }
        
        #d3WordCloud { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        #d3WordCloud svg { width: 100%; height: 100%; }
        .d3-word { cursor: pointer; transition: all 0.3s ease; }
        .d3-word:hover { fill: var(--accent) !important; transform: scale(1.05); }
        
        .analytics-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .analytics-tabs { display: flex; gap: 10px; }
        .analytics-tab { padding: 8px 15px; background: var(--light-gray); border-radius: 30px; cursor: pointer; font-size: 0.9rem; }
        .analytics-tab.active { background: var(--interview); color: white; }
        
        .error-msg { color: var(--accent); text-align: center; padding: 20px; }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-comments"></i>
                    <h1>Dcard 面試心得與職涯討論平台</h1>
                </div>
                <div class="nav-links">
                    <a href="index.html" class="active"><i class="fas fa-home"></i> 首頁</a>
                    <a href="#"><i class="fas fa-clipboard-list"></i> 面試心得</a>
                    <a href="#"><i class="fas fa-users"></i> 職涯討論</a>
                    <a href="#"><i class="fas fa-bookmark"></i> 我的收藏</a>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="hero-section">
            <h2>探索 Dcard 上的面試心得與職涯討論</h2>
            <p>我們從 Dcard 工作版蒐集最新面試經驗與職涯討論，幫助您求職準備與職涯規劃</p>
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="搜尋公司、職位或關鍵字...">
                <button id="searchBtn"><i class="fas fa-search"></i> 搜尋</button>
            </div>
            <div class="stats-cards">
                <div class="stat-card"><div class="number">1,258</div><div class="label">面試心得</div></div>
                <div class="stat-card"><div class="number">326</div><div class="label">熱門公司</div></div>
                <div class="stat-card"><div class="number">98%</div><div class="label">實際經驗</div></div>
                <div class="stat-card"><div class="number">24</div><div class="label">職涯主題</div></div>
            </div>
        </div>

        <div class="filters">
            <button class="filter-btn active"><i class="fas fa-list"></i> 全部內容</button>
            <button class="filter-btn"><i class="fas fa-laptop-code"></i> 科技業</button>
            <button class="filter-btn"><i class="fas fa-landmark"></i> 金融業</button>
            <button class="filter-btn"><i class="fas fa-graduation-cap"></i> 新鮮人</button>
        </div>

        <div class="tab-container">
            <div class="tab active" data-tab="all">全部內容</div>
            <div class="tab" data-tab="interview">面試心得</div>
            <div class="tab" data-tab="discussion">職涯討論</div>
        </div>

        <div class="main-content">
            <div class="interview-listings">
                <div class="section-title">
                    <h2><i class="fas fa-comment-dots"></i> 近期熱門討論</h2>
                    <span>共 <span id="postCount">8</span> 篇內容</span>
                </div>
                <div class="interview-list" id="interviewList"></div>
            </div>

            <div class="analytics-section">
                <div class="analytics-header">
                    <h2><i class="fas fa-chart-line"></i> 數據分析與洞察</h2>
                    <div class="analytics-tabs">
                        <div class="analytics-tab active" data-tab="keywords">關鍵字</div>
                        <div class="analytics-tab" data-tab="results">面試結果</div>
                    </div>
                </div>
                
                <div class="chart-row">
                    <div class="wordcloud-container">
                        <div class="section-title"><h3><i class="fas fa-cloud"></i> 熱門關鍵字文字雲</h3></div>
                        <div id="d3WordCloud"></div>
                    </div>
                    <div class="chart-container">
                        <div class="section-title"><h3><i class="fas fa-chart-pie"></i> 面試結果分佈</h3></div>
                        <canvas id="resultChart"></canvas>
                        <div class="chart-center-label">
                            <div class="main">面試結果</div>
                            <div id="resultChartTotal" class="sub">載入中...</div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-row">
                    <div class="chart-container">
                        <div class="section-title"><h3><i class="fas fa-star"></i> 面試難度分佈</h3></div>
                        <canvas id="difficultyChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="section-title"><h3><i class="fas fa-money-bill-wave"></i> 公司薪資比較</h3></div>
                        <canvas id="salaryChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>資料來源：Dcard 工作板</p>
    </footer>

    <!-- 外部資料檔案 -->
    <script src="./js/hot.js"></script>
    <script src="./js/f.js"></script>
    
    <!-- 主程式碼 -->
    <script>
        // 內容數據
        const contentData = [
            {
                id: 1, title: "Google 軟體工程師面試全記錄", type: "interview", company: "Google", position: "軟體工程師",
                result: "錄取", difficulty: 4, author: "匿名", posted: "2天前", views: 1245, likes: 89, comments: 32,
                tags: ["科技業", "工程師", "FAANG", "LeetCode"],
                preview: "第一關是線上測驗，包含兩道中等難度的LeetCode題目，時間90分鐘。第二關是電話面試，主要考系統設計..."
            },
            {
                id: 2, title: "該繼續留在舒適圈還是挑戰新機會？", type: "discussion", author: "職涯迷途者",
                posted: "5天前", views: 2456, likes: 145, comments: 78, tags: ["職涯規劃", "迷茫", "選擇困難", "轉職"],
                preview: "已經在這家公司三年了，每天工作內容都差不多，學不到新東西。新offer薪資很不錯，但聽說加班文化嚴重..."
            },
            {
                id: 3, title: "台積電設備工程師面試經驗分享", type: "interview", company: "台積電", position: "設備工程師",
                result: "錄取", difficulty: 3, author: "工程新鮮人", posted: "3天前", views: 1890, likes: 76, comments: 41,
                tags: ["半導體", "新鮮人", "輪班", "設備工程"],
                preview: "第一關人資面談主要了解個人背景和求職動機，第二關專業測驗有60題選擇題，時間90分鐘..."
            },
            {
                id: 4, title: "非本科轉職軟體工程師的心路歷程", type: "discussion", author: "轉職成功者",
                posted: "1週前", views: 3210, likes: 210, comments: 92, tags: ["轉職", "自學", "非本科", "工程師"],
                preview: "一開始完全沒有程式基礎，從freeCodeCamp和Udemy課程開始學習HTML/CSS/JavaScript..."
            },
            {
                id: 5, title: "Amazon PM 面試全過程", type: "interview", company: "Amazon", position: "產品經理",
                result: "未錄取", difficulty: 5, author: "匿名", posted: "1天前", views: 980, likes: 42, comments: 18,
                tags: ["產品經理", "FAANG", "領導力原則", "案例分析"],
                preview: "第一關是電話面試，主要詢問過往產品經驗和解決問題的方法。現場面試包含四輪，每輪45分鐘..."
            },
            {
                id: 6, title: "30歲該追求穩定還是冒險創業？", type: "discussion", author: "三十而立",
                posted: "4天前", views: 1876, likes: 98, comments: 56, tags: ["創業", "職涯選擇", "三十歲", "人生規劃"],
                preview: "已經工作七年，累積了一定的存款和人脈。創業點子很有潛力，但擔心失敗後難以回到職場..."
            },
            {
                id: 7, title: "金融業MA計畫面試經驗", type: "interview", company: "國泰金控", position: "儲備幹部",
                result: "錄取", difficulty: 4, author: "金融新鮮人", posted: "3天前", views: 1560, likes: 67, comments: 29,
                tags: ["金融業", "儲備幹部", "新鮮人", "群體面試"],
                preview: "團體面試時8人一組，討論金融科技對銀行的影響。個案分析需要在2小時內完成一份投資建議報告..."
            },
            {
                id: 8, title: "如何克服職場焦慮與自我懷疑？", type: "discussion", author: "焦慮小職員",
                posted: "2天前", views: 2100, likes: 124, comments: 87, tags: ["心理健康", "職場焦慮", "自我成長", "工作壓力"],
                preview: "每天上班前都會感到胃痛，晚上難以入睡。經過與心理師的諮商，學習了一些應對技巧..."
            }
        ];

        // 渲染內容列表
        function renderContent(content) {
            const contentList = document.getElementById('interviewList');
            contentList.innerHTML = '';
            
            if (content.length === 0) {
                contentList.innerHTML = '<div class="error-msg"><i class="fas fa-search"></i><h3>沒有找到相關內容</h3></div>';
                return;
            }
            
            content.forEach(item => {
                const card = document.createElement('div');
                card.className = `interview-card ${item.type === 'discussion' ? 'discussion' : ''}`;
                
                const meta = item.type === 'interview' 
                    ? `<span><i class="fas fa-building"></i> ${item.company}</span>
                       <span><i class="fas fa-briefcase"></i> ${item.position}</span>
                       <span><i class="fas fa-${item.result === '錄取' ? 'check-circle' : 'times-circle'}"></i> ${item.result}</span>`
                    : `<span><i class="fas fa-user"></i> ${item.author}</span>`;
                
                card.innerHTML = `
                    <h3>${item.title}</h3>
                    <div class="interview-meta">
                        ${meta}
                        <span><i class="fas fa-clock"></i> ${item.posted}</span>
                        <span><i class="fas fa-eye"></i> ${item.views} 次瀏覽</span>
                    </div>
                    <div class="interview-content">${item.preview}</div>
                    <div class="interview-tags">
                        ${item.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    <div class="interview-meta">
                        <span><i class="fas fa-heart"></i> ${item.likes} 個喜歡</span>
                        <span><i class="fas fa-comment"></i> ${item.comments} 則留言</span>
                    </div>
                `;
                
                contentList.appendChild(card);
            });
            
            document.getElementById('postCount').textContent = content.length;
        }

        // 創建文字雲 - 完全依賴外部 hot.js 資料
        function initWordCloud() {
            const container = document.getElementById('d3WordCloud');
            if (!container) return;
            
            // 檢查外部資料是否存在
            if (!window.hotKeywords || window.hotKeywords.length === 0) {
                container.innerHTML = '<div class="error-msg"><i class="fas fa-exclamation-triangle"></i><h3>無法載入熱門關鍵字資料</h3><p>請確保 hot.js 檔案存在於 js/ 資料夾中</p></div>';
                return;
            }
            
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            const svg = d3.select(container)
                .append("svg")
                .attr("width", width)
                .attr("height", height);
            
            d3.layout.cloud()
                .size([width, height])
                .words(window.hotKeywords.map(d => ({
                    text: d.text,
                    size: d.size * 0.8,
                    color: ['#4a6fa5', '#ff6b6b', '#28a745', '#6a5acd'][Math.floor(Math.random() * 4)]
                })))
                .padding(5)
                .rotate(() => (Math.random() * 2 - 1) * 30)
                .font("Microsoft JhengHei")
                .fontSize(d => d.size)
                .on("end", words => {
                    svg.append("g")
                        .attr("transform", `translate(${width/2},${height/2})`)
                        .selectAll("text")
                        .data(words)
                        .enter().append("text")
                        .style("font-size", d => `${d.size}px`)
                        .style("font-family", "Microsoft JhengHei")
                        .style("fill", d => d.color)
                        .attr("text-anchor", "middle")
                        .attr("transform", d => `translate(${d.x}, ${d.y})rotate(${d.rotate})`)
                        .text(d => d.text)
                        .attr("class", "d3-word")
                        .on("click", (_, d) => {
                            document.getElementById('searchInput').value = d.text;
                            document.getElementById('searchBtn').click();
                        });
                })
                .start();
        }

        // 初始化圖表 - 完全依賴外部 f.js 資料
        function initCharts() {
            // 檢查外部資料是否存在
            if (!window.interviewResults || window.interviewResults.length === 0) {
                document.getElementById('resultChartTotal').textContent = '資料載入失敗';
                return;
            }
            
            // 面試結果分佈圖
            const total = window.interviewResults.reduce((sum, item) => sum + item.value, 0);
            document.getElementById('resultChartTotal').textContent = `${total} 篇心得`;
            
            new Chart(document.getElementById('resultChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: window.interviewResults.map(item => item.label),
                    datasets: [{
                        data: window.interviewResults.map(item => item.value),
                        backgroundColor: ['#28a745', '#ff6b6b', '#4a6fa5', '#6c757d']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '65%',
                    plugins: { legend: { position: 'bottom' } }
                }
            });
            
            // 面試難度分佈圖
            new Chart(document.getElementById('difficultyChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['1星', '2星', '3星', '4星', '5星'],
                    datasets: [{
                        data: [5, 12, 35, 30, 18],
                        backgroundColor: 'rgba(111, 90, 205, 0.7)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, max: 40 } }
                }
            });
            
            // 公司薪資比較圖
            new Chart(document.getElementById('salaryChart').getContext('2d'), {
                type: 'radar',
                data: {
                    labels: ['Google', '台積電', '聯發科', '國泰金控', 'Amazon', '微軟'],
                    datasets: [{
                        label: '平均月薪資 (千元)',
                        data: [250, 65, 150, 75, 200, 180],
                        fill: true,
                        backgroundColor: 'rgba(106, 90, 205, 0.2)',
                        borderColor: 'rgba(106, 90, 205, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { r: { suggestedMin: 0, suggestedMax: 300 } }
                }
            });
        }

        // 搜尋功能
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');
            
            const search = () => {
                const term = searchInput.value.toLowerCase().trim();
                if (!term) return renderContent(contentData);
                
                const filtered = contentData.filter(item => {
                    const text = item.title.toLowerCase() + item.preview.toLowerCase() + item.tags.join(' ').toLowerCase();
                    return text.includes(term);
                });
                
                renderContent(filtered);
            };
            
            searchBtn.addEventListener('click', search);
            searchInput.addEventListener('keyup', (e) => e.key === 'Enter' && search());
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            renderContent(contentData);
            setupSearch();
            
            // 等待外部檔案載入後初始化圖表和文字雲
            setTimeout(() => {
                initCharts();
                initWordCloud();
            }, 500); // 給外部檔案更多時間載入
            
            // 篩選功能
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    const filter = btn.textContent.replace(/\s+/g, '');
                    if (filter === '全部內容') return renderContent(contentData);
                    
                    renderContent(contentData.filter(item => 
                        item.tags.some(tag => tag.includes(filter))
                    ));
                });
            });
            
            // 標籤頁功能
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    const type = tab.getAttribute('data-tab');
                    if (type === 'all') return renderContent(contentData);
                    
                    renderContent(contentData.filter(item => item.type === type));
                });
            });
            
            // 響應式調整
            window.addEventListener('resize', () => setTimeout(initWordCloud, 100));
        });
    </script>
</body>
</html>
