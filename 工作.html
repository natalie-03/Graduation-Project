<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工作心得交流 - 真實數據平台</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3.layout.cloud.js"></script>

    <style>
        :root {
            /* 主色調：更沈穩的科技藍 */
            --primary: #2c3e50;
            --primary-light: #34495e;
            --accent: #3498db;
            --accent-hover: #2980b9;
            
            /* 功能色 */
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            
            /* 背景與文字 */
            --bg-body: #f4f6f8;
            --bg-card: #ffffff;
            --text-main: #2c3e50;
            --text-sub: #7f8c8d;
            --border: #ecf0f1;
            
            /* 分類標籤顏色 */
            --tag-interview: #e8f6fd; /* 淺藍底 */
            --tag-text-interview: #2980b9;
            --tag-discuss: #fef9e7; /* 淺黃底 */
            --tag-text-discuss: #d35400;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Noto Sans TC', sans-serif; }
        
        body { 
            background-color: var(--bg-body); 
            color: var(--text-main); 
            line-height: 1.6; 
            padding-bottom: 40px;
        }

        /* --- Header --- */
        header {
            background: var(--bg-card);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-inner {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            text-decoration: none;
            color: var(--text-main);
        }
        .logo i { font-size: 1.8rem; color: var(--accent); }
        .logo h1 { font-size: 1.4rem; font-weight: 700; letter-spacing: 0.5px; }

        .nav-links { display: flex; gap: 10px; }
        .nav-item {
            color: var(--text-sub);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s;
            font-size: 0.95rem;
        }
        .nav-item:hover, .nav-item.active {
            background-color: var(--bg-body);
            color: var(--accent);
        }

        /* --- Container Layout --- */
        .container { 
            max-width: 1400px; 
            margin: 30px auto; 
            padding: 0 30px; 
        }

        /* --- Hero Section --- */
        .hero-section {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 20px;
            padding: 50px;
            color: white;
            text-align: center;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(44, 62, 80, 0.2);
            position: relative;
            overflow: hidden;
        }

        .hero-content { position: relative; z-index: 2; }
        .hero-section h2 { font-size: 2.2rem; margin-bottom: 10px; font-weight: 700; }
        .hero-section p { font-size: 1.1rem; opacity: 0.9; margin-bottom: 30px; }

        .search-container {
            max-width: 600px;
            margin: 0 auto 40px;
            position: relative;
            display: flex;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-radius: 50px;
        }
        
        .search-container input {
            flex: 1;
            padding: 16px 25px;
            border: none;
            border-radius: 50px 0 0 50px;
            font-size: 1rem;
            outline: none;
        }
        
        .search-container button {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 0 30px;
            border-radius: 0 50px 50px 0;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background 0.3s;
        }
        .search-container button:hover { background-color: var(--accent-hover); }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: transform 0.3s;
        }
        .stat-card:hover { transform: translateY(-5px); background: rgba(255, 255, 255, 0.15); }
        .stat-number { font-size: 2rem; font-weight: 700; margin-bottom: 5px; }
        .stat-label { font-size: 0.9rem; opacity: 0.8; }

        /* --- Controls & Filters --- */
        .controls-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .filter-group { display: flex; gap: 10px; }
        .filter-btn {
            background: white;
            border: 1px solid var(--border);
            padding: 8px 18px;
            border-radius: 50px;
            color: var(--text-sub);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .filter-btn:hover { border-color: var(--accent); color: var(--accent); }
        .filter-btn.active { background: var(--accent); color: white; border-color: var(--accent); box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3); }

        .tab-group {
            background: white;
            padding: 4px;
            border-radius: 50px;
            display: flex;
            border: 1px solid var(--border);
        }
        .tab-btn {
            padding: 8px 20px;
            border-radius: 50px;
            cursor: pointer;
            color: var(--text-sub);
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .tab-btn.active { background: var(--primary); color: white; font-weight: 500; }

        /* --- Main Grid Layout --- */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 4fr 5fr; /* 左窄右寬，或依需求調整 */
            gap: 30px;
            align-items: start;
        }
        @media (max-width: 1024px) { .dashboard-grid { grid-template-columns: 1fr; } }

        /* --- Content List Section --- */
        .section-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            border: 1px solid var(--border);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .section-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .section-header h3 { font-size: 1.1rem; color: var(--text-main); font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .section-header .count { font-size: 0.85rem; color: var(--text-sub); background: var(--bg-body); padding: 2px 10px; border-radius: 10px; }

        .list-container {
            height: 800px;
            overflow-y: auto;
            padding: 20px;
            background-color: #fafbfc;
        }
        /* 美化 Scrollbar */
        .list-container::-webkit-scrollbar { width: 6px; }
        .list-container::-webkit-scrollbar-track { background: transparent; }
        .list-container::-webkit-scrollbar-thumb { background: #dcdcdc; border-radius: 10px; }
        .list-container::-webkit-scrollbar-thumb:hover { background: #bbb; }

        .post-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }
        .post-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.05);
            border-color: var(--accent);
        }
        
        /* 卡片左側指示條 */
        .post-card::before {
            content: '';
            position: absolute;
            left: 0; top: 12px; bottom: 12px;
            width: 4px;
            border-radius: 0 4px 4px 0;
            background-color: var(--text-sub);
        }
        .post-card.type-interview::before { background-color: var(--accent); }
        .post-card.type-discussion::before { background-color: var(--warning); }

        .post-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 10px; color: var(--text-main); line-height: 1.4; }
        
        .post-meta { display: flex; flex-wrap: wrap; gap: 15px; font-size: 0.85rem; color: var(--text-sub); margin-bottom: 12px; }
        .meta-item { display: flex; align-items: center; gap: 5px; }
        .meta-item i { color: #bdc3c7; }
        
        .post-preview { font-size: 0.95rem; color: #555; margin-bottom: 15px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        
        .post-tags { display: flex; gap: 8px; flex-wrap: wrap; }
        .tag { font-size: 0.8rem; padding: 4px 12px; border-radius: 4px; background: var(--bg-body); color: var(--text-sub); }
        
        .status-badge {
            padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 500;
        }
        .status-success { background: #d4edda; color: #155724; }
        .status-fail { background: #f8d7da; color: #721c24; }
        .status-wait { background: #fff3cd; color: #856404; }

        /* --- Analytics Section --- */
        .charts-column { display: flex; flex-direction: column; gap: 30px; }
        
        .chart-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            border: 1px solid var(--border);
        }
        .chart-header { margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        .chart-header h4 { font-size: 1.1rem; font-weight: 700; color: var(--text-main); }

        .chart-wrapper { position: relative; height: 300px; width: 100%; }
        
        .dual-chart-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) { .dual-chart-row { grid-template-columns: 1fr; } }

        /* D3 Word Cloud Specifics */
        #d3WordCloud { width: 100%; height: 100%; overflow: hidden; }
        .d3-word { cursor: pointer; transition: opacity 0.3s; }
        .d3-word:hover { opacity: 0.8; }

        /* --- Footer --- */
        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid var(--border);
            color: var(--text-sub);
            font-size: 0.9rem;
        }
        .data-status {
            display: inline-block;
            margin-top: 10px;
            padding: 5px 15px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 0.8rem;
        }

        /* Loading & Errors */
        .loading-state { text-align: center; padding: 40px; color: var(--text-sub); }
        .error-state { text-align: center; padding: 40px; color: var(--danger); background: #fff5f5; border-radius: 8px; margin: 20px; }

    </style>
</head>
<body>

    <header>
        <div class="header-inner">
            <a href="#" class="logo">
                <i class="fas fa-chart-network"></i>
                <h1>Dcard 職場數據洞察</h1>
            </a>
            <nav class="nav-links">
                <a href="index.html" class="nav-item active"><i class="fas fa-home"></i> 首頁</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="hero-section">
            <div class="hero-content">
                <h2>探索真實的面試與職場經驗</h2>
                <p>匯集 Dcard 工作版精華，數據化分析幫助你做出更好選擇</p>
                
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="搜尋公司、職位或關鍵字...">
                    <button id="searchBtn">搜尋</button>
                </div>

                
            </div>
        </div>

        <div class="controls-bar">
            <div class="filter-group">
                <button class="filter-btn active"><i class="fas fa-th-large"></i> 全部</button>
                <button class="filter-btn"><i class="fas fa-code"></i> 科技業</button>
                <button class="filter-btn"><i class="fas fa-chart-line"></i> 金融業</button>
                <button class="filter-btn"><i class="fas fa-user-graduate"></i> 新鮮人</button>
            </div>

            <div class="tab-group">
                <div class="tab-btn active" data-tab="all">綜合顯示</div>
                <div class="tab-btn" data-tab="interview">面試心得</div>
                <div class="tab-btn" data-tab="discussion">職涯請益</div>
            </div>
        </div>

        <div class="dashboard-grid">
            
            <div class="section-card">
                <div class="section-header">
                    <h3><i class="fas fa-stream"></i> 最新討論串</h3>
                    <span class="count">共 <span id="postCount">0</span> 篇</span>
                </div>
                <div class="list-container" id="interviewList">
                    <div class="loading-state">
                        <i class="fas fa-spinner fa-spin fa-2x"></i>
                        <p style="margin-top: 10px;">資料載入中...</p>
                    </div>
                </div>
            </div>

            <div class="charts-column">
                
                <div class="dual-chart-row">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h4><i class="fas fa-cloud"></i> 熱門關鍵字</h4>
                        </div>
                        <div class="chart-wrapper">
                            <div id="d3WordCloud"></div>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h4><i class="fas fa-pie-chart"></i> 面試結果統計</h4>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="resultChart"></canvas>
                        </div>
                    </div>
                </div>

                

                <div class="chart-card">
                    <div class="chart-header">
                        <h4><i class="fas fa-coins"></i> 熱門公司薪資水平比較 (月薪/千元)</h4>
                    </div>
                    <div class="chart-wrapper" style="height: 350px;">
                        <canvas id="salaryChart"></canvas>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <footer>
        <p>© 2025 Dcard 職場數據洞察平台 | 此為資料分析練習專案，非官方頁面</p>
        <div class="data-status" id="dataSourceInfo">系統初始化...</div>
    </footer>

    <script src="./js/hot.js"></script>
    <script src="./js/f.js"></script>
    <script src="./js/t.js"></script>
    <script src="./js/content.js"></script>
    
    <script>
        // 備用數據，防止外部檔案缺失導致空白
        const backupContentData = [];

        /* --- 渲染列表邏輯 --- */
        function renderContent(content) {
            const contentList = document.getElementById('interviewList');
            contentList.innerHTML = '';
            
            if (!content || content.length === 0) {
                contentList.innerHTML = '<div class="error-state"><i class="fas fa-search"></i><p>沒有找到相關內容</p></div>';
                return;
            }
            
            content.forEach(item => {
                const card = document.createElement('div');
                const isInterview = item.type === 'interview';
                card.className = `post-card type-${item.type || 'general'}`;
                
                // 構建 Meta 資訊
                let metaHtml = '';
                if (isInterview) {
                    let resultBadgeClass = item.result === '錄取' ? 'status-success' : (item.result === '未錄取' ? 'status-fail' : 'status-wait');
                    metaHtml = `
                        <div class="meta-item"><i class="fas fa-building"></i> ${item.company || '未知公司'}</div>
                        <div class="meta-item"><i class="fas fa-briefcase"></i> ${item.position || '職位不詳'}</div>
                        <div class="status-badge ${resultBadgeClass}">${item.result || '結果未定'}</div>
                    `;
                } else {
                    metaHtml = `<div class="meta-item"><i class="fas fa-user-circle"></i> ${item.author || '匿名用戶'}</div>`;
                }

                // 構建標籤
                const tagsHtml = (item.tags || []).map(tag => `<span class="tag">#${tag}</span>`).join('');

                card.innerHTML = `
                    <div class="post-title">${item.title || '無標題'}</div>
                    <div class="post-meta">
                        ${metaHtml}
                        <div class="meta-item" style="margin-left: auto; font-size: 0.8rem;">${item.posted || ''}</div>
                    </div>
                    <div class="post-preview">${item.preview || '無預覽內容...'}</div>
                    <div class="post-tags">${tagsHtml}</div>
                `;
                
                contentList.appendChild(card);
            });
            
            document.getElementById('postCount').textContent = content.length;
        }

        /* --- 文字雲邏輯 --- */
        function initWordCloud() {
            const container = document.getElementById('d3WordCloud');
            if (!container) return;
            
            // 使用 CSS 變數中的顏色
            const colors = ['#2c3e50', '#3498db', '#27ae60', '#e67e22', '#8e44ad'];
            
            if (!window.hotKeywords || window.hotKeywords.length === 0) {
                container.innerHTML = '<div class="loading-state">無文字雲數據</div>';
                return;
            }
            
            container.innerHTML = ''; 
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            const svg = d3.select(container).append("svg")
                .attr("width", width)
                .attr("height", height);
            
            d3.layout.cloud()
                .size([width, height])
                .words(window.hotKeywords.map(d => ({
                    text: d.text,
                    size: d.size * 0.8, // 稍微縮小一點以適應容器
                    color: colors[Math.floor(Math.random() * colors.length)]
                })))
                .padding(10)
                .rotate(() => 0) // 讓文字保持水平，比較整齊
                .font("Noto Sans TC")
                .fontSize(d => d.size)
                .on("end", words => {
                    svg.append("g")
                        .attr("transform", `translate(${width/2},${height/2})`)
                        .selectAll("text")
                        .data(words)
                        .enter().append("text")
                        .style("font-size", d => `${d.size}px`)
                        .style("font-family", "Noto Sans TC")
                        .style("font-weight", "bold")
                        .style("fill", d => d.color)
                        .attr("text-anchor", "middle")
                        .attr("transform", d => `translate(${d.x}, ${d.y})rotate(${d.rotate})`)
                        .text(d => d.text)
                        .attr("class", "d3-word")
                        .on("click", (_, d) => {
                            document.getElementById('searchInput').value = d.text;
                            document.getElementById('searchBtn').click();
                        });
                })
                .start();
        }

        /* --- 圖表邏輯 --- */
        function initCharts() {
            // 共用圖表配置
            Chart.defaults.font.family = "'Noto Sans TC', sans-serif";
            Chart.defaults.color = '#7f8c8d';

            // 1. 面試結果圓餅圖
            const resultCtx = document.getElementById('resultChart');
            if (resultCtx && window.interviewResults) {
                new Chart(resultCtx, {
                    type: 'doughnut',
                    data: {
                        labels: window.interviewResults.map(i => i.label),
                        datasets: [{
                            data: window.interviewResults.map(i => i.value),
                            backgroundColor: ['#27ae60', '#e74c3c', '#3498db', '#95a5a6'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'right', labels: { boxWidth: 12 } }
                        },
                        cutout: '70%'
                    }
                });
            }

            // 2. 難度長條圖
            const diffCtx = document.getElementById('difficultyChart');
            if (diffCtx) {
                new Chart(diffCtx, {
                    type: 'bar',
                    data: {
                        labels: ['1星', '2星', '3星', '4星', '5星'],
                        datasets: [{
                            label: '人數',
                            data: [5, 12, 35, 30, 18],
                            backgroundColor: '#34495e',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { 
                            y: { beginAtZero: true, grid: { borderDash: [2, 4] } },
                            x: { grid: { display: false } }
                        }
                    }
                });
            }

            // 3. 薪資雷達圖
            const salaryCtx = document.getElementById('salaryChart');
            if (salaryCtx) {
                let salaryData = window.companySalaries || window.chartCompanySalaries || {
                    labels: ['Google', 'TSMC', 'MTK', 'Shopee', 'Line'],
                    datasets: [{
                        label: '平均月薪',
                        data: [150, 80, 120, 70, 90],
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: '#3498db',
                        pointBackgroundColor: '#3498db'
                    }]
                };

                new Chart(salaryCtx, {
                    type: 'radar',
                    data: salaryData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                angleLines: { color: '#ecf0f1' },
                                grid: { color: '#ecf0f1' },
                                pointLabels: { font: { size: 12, weight: 'bold' }, color: '#2c3e50' }
                            }
                        },
                        plugins: { legend: { position: 'bottom' } }
                    }
                });
            }
        }

        /* --- 初始化與事件監聽 --- */
        document.addEventListener('DOMContentLoaded', () => {
            // 數據載入檢查
            const hasData = window.realContentData && window.realContentData.length > 0;
            const displayData = hasData ? window.realContentData : backupContentData;
            
            // 渲染主要內容
            renderContent(displayData);
            
            // 狀態列更新
            const statusEl = document.getElementById('dataSourceInfo');
            statusEl.innerHTML = `數據來源: JS本地文件 | 內容數: ${displayData.length} | 狀態: ${hasData ? '正常' : '無數據(請檢查content.js)'}`;

            // 延遲初始化圖表以確保容器大小正確
            setTimeout(() => {
                initCharts();
                initWordCloud();
            }, 300);

            // 搜尋功能
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');
            const doSearch = () => {
                const term = searchInput.value.toLowerCase().trim();
                const source = window.realContentData || [];
                const filtered = term ? source.filter(item => 
                    (item.title+item.preview+item.company).toLowerCase().includes(term)
                ) : source;
                renderContent(filtered);
            };
            searchBtn.addEventListener('click', doSearch);
            searchInput.addEventListener('keyup', (e) => e.key === 'Enter' && doSearch());

            // 篩選按鈕互動
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    // 這裡可以加入實際篩選邏輯
                    const filterText = this.textContent.trim();
                    if(filterText === "全部") doSearch(); // 簡化處理：重置
                    else {
                         // 簡單示範篩選
                         const source = window.realContentData || [];
                         const filtered = source.filter(item => JSON.stringify(item).includes(filterText) || (item.tags && item.tags.join('').includes(filterText)));
                         renderContent(filtered);
                    }
                });
            });

            // 響應式圖表重繪
            window.addEventListener('resize', () => {
                const cloudContainer = document.getElementById('d3WordCloud');
                if(cloudContainer) cloudContainer.innerHTML = '';
                initWordCloud();
            });
        });
    </script>
</body>
</html>
