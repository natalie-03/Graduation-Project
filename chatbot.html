<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>chatbotå°å¹«æ‰‹</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.1.0/src/wordcloud2.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- å¼•å…¥å¤–éƒ¨æ•¸æ“šæ–‡ä»¶ -->
    <script src="./js/grad_trends.js"></script>
    <script src="./js/food_trends.js"></script>
    <script src="./js/data.js"></script>

    <style>
        :root {
            --primary: #00f2fe;
            --secondary: #4facfe;
            --accent: #667eea;
            --dark: #0f172a;
            --darker: #0a0f1c;
            --light: #1e293b;
            --text: #e2e8f0;
            --text-secondary: #94a3b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        .tech-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 80%, rgba(79, 172, 254, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(0, 242, 254, 0.05) 0%, transparent 50%);
            z-index: -1;
        }

        .grid-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                linear-gradient(rgba(79, 172, 254, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(79, 172, 254, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -1;
            opacity: 0.3;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .main-content {
            display: flex;
            gap: 20px;
            flex: 1;
            min-height: 0;
        }

        .chatbot-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(79, 172, 254, 0.2);
            border-radius: 16px;
            overflow: hidden;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid rgba(79, 172, 254, 0.2);
            text-align: center;
        }

        .chat-header h2 {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: var(--text);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.6);
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: linear-gradient(var(--primary), var(--secondary));
            border-radius: 3px;
        }

        .message {
            max-width: 80%;
            padding: 15px;
            border-radius: 18px;
            line-height: 1.5;
            position: relative;
            animation: fadeInUp 0.3s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--dark);
            border-bottom-right-radius: 5px;
        }

        .bot-message {
            align-self: flex-start;
            background: rgba(42, 77, 105, 0.6);
            border: 1px solid rgba(79, 172, 254, 0.3);
            border-bottom-left-radius: 5px;
        }

        .quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .quick-reply {
            background: rgba(79, 172, 254, 0.1);
            border: 1px solid rgba(79, 172, 254, 0.3);
            color: var(--text);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-reply:hover {
            background: rgba(79, 172, 254, 0.2);
            transform: translateY(-2px);
        }

        .chat-input {
            padding: 20px;
            border-top: 1px solid rgba(79, 172, 254, 0.2);
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 12px 16px;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(79, 172, 254, 0.3);
            border-radius: 25px;
            color: var(--text);
            outline: none;
            transition: all 0.3s ease;
        }

        .chat-input input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 242, 254, 0.1);
        }

        .send-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--dark);
        }

        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 242, 254, 0.4);
        }

        .visualization-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(79, 172, 254, 0.2);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .chart-container {
            flex: 1;
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(79, 172, 254, 0.2);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .chart-container h3 {
            margin-bottom: 15px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-area {
            flex: 1;
            position: relative;
        }

        canvas {
            width: 100% !important;
            height: 100% !important;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(79, 172, 254, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }

            .chatbot-section,
            .visualization-section {
                min-height: 400px;
            }

            .stats-cards {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2rem;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: rgba(30, 41, 59, 0.9);
            color: var(--text);
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateX(200%);
            transition: transform 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid rgba(79, 172, 254, 0.3);
            backdrop-filter: blur(10px);
        }

        .notification.show {
            transform: translateX(0);
        }
    </style>
</head>

<body>
    <div class="tech-bg"></div>
    <div class="grid-overlay"></div>

    <div class="container">
        <div class="header">
            <h1><i class="fas fa-robot"></i> chatbotå°å¹«æ‰‹</h1>
            <p class="subtitle">æ™ºèƒ½èŠå¤©æ©Ÿå™¨äºº</p>
        </div>

        <div class="main-content">
            <!-- èŠå¤©æ©Ÿå™¨äººå€åŸŸ -->
            <div class="chatbot-section">
                <div class="chat-header">
                    <h2><i class="fas fa-comments"></i> æ™ºèƒ½å°è©±</h2>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message bot-message">
                        <p>ğŸ‘‹ æ‚¨å¥½ï¼æˆ‘æ˜¯chatbotå°å¹«æ‰‹ï¼Œå¯ä»¥ç‚ºæ‚¨æä¾›ï¼š</p>
                        <div class="quick-replies">
                            <div class="quick-reply" onclick="sendMessage('ç ”ç©¶æ‰€åˆ†æ')">
                                ç ”ç©¶æ‰€æ•¸æ“šåˆ†æ
                            </div>
                            <div class="quick-reply" onclick="sendMessage('ç¾é£Ÿåˆ†æ')">
                                ç¾é£Ÿè¶¨å‹¢åˆ†æ
                            </div>
                            <div class="quick-reply" onclick="sendMessage('å­¸æ ¡æ’å')">
                                å­¸æ ¡ç†±é–€æ’å
                            </div>
                            <div class="quick-reply" onclick="sendMessage('æ™¯é»æ’è¡Œ')">
                                æ™¯é»æ’è¡Œ
                            </div>
                        </div>
                        <p>è«‹é¸æ“‡æ‚¨æ„Ÿèˆˆè¶£çš„ä¸»é¡Œï¼Œæˆ–ç›´æ¥è¼¸å…¥æ‚¨çš„å•é¡Œï¼</p>
                    </div>
                </div>
                <div class="chat-input">
                    <input type="text" id="userInput" placeholder="è¼¸å…¥æ‚¨çš„å•é¡Œ..." onkeypress="handleKeyPress(event)">
                    <button class="send-btn" onclick="sendUserMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <!-- æ•¸æ“šå¯è¦–åŒ–å€åŸŸ -->
            <div class="visualization-section">
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-number" id="totalSchools">-</div>
                        <div class="stat-label">ç†±é–€å­¸æ ¡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalCuisines">-</div>
                        <div class="stat-label">ç†±é–€èœç³»</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalArticles">-</div>
                        <div class="stat-label">åˆ†ææ–‡ç« æ•¸</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalDepartments">-</div>
                        <div class="stat-label">ç†±é–€ç§‘ç³»</div>
                    </div>
                </div>
                <div class="chart-container">
                    <h3><i class="fas fa-chart-bar"></i> æ•¸æ“šå¯è¦–åŒ–</h3>
                    <div class="chart-area">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i> <span id="notificationText">æ“ä½œæˆåŠŸ</span>
    </div>

    <script>
        // å…¨å±€è®Šæ•¸
        let currentChart = null;
        let currentMode = 'welcome'; // welcome, grad, food, spot

        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.getElementById('notification');
            const textElement = document.getElementById('notificationText');

            textElement.textContent = message;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©å®¤
        function addMessage(text, isUser = false) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;

            const messageContent = document.createElement('div');
            messageContent.innerHTML = text;
            messageDiv.appendChild(messageContent);

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            return messageDiv;
        }

        // ç™¼é€ç”¨æˆ¶æ¶ˆæ¯
        function sendUserMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();

            if (message) {
                sendMessage(message);
                input.value = '';
            }
        }

        // è™•ç†æŒ‰éµäº‹ä»¶
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendUserMessage();
            }
        }

        // ä¸»è¦æ¶ˆæ¯è™•ç†å‡½æ•¸
        function sendMessage(message) {
            // æ·»åŠ ç”¨æˆ¶æ¶ˆæ¯
            addMessage(message, true);

            // é¡¯ç¤ºæ­£åœ¨è¼¸å…¥æŒ‡ç¤ºå™¨
            const loadingMessage = addMessage('æ€è€ƒä¸­<span class="loading"></span>', false);

            // æ¨¡æ“¬AIæ€è€ƒæ™‚é–“
            setTimeout(() => {
                // ç§»é™¤åŠ è¼‰æŒ‡ç¤ºå™¨
                loadingMessage.remove();

                // è™•ç†æ¶ˆæ¯ä¸¦ç”Ÿæˆå›è¦†
                processMessage(message);
            }, 1000);
        }

        // è™•ç†æ¶ˆæ¯å…§å®¹
        function processMessage(message) {
            const lowerMessage = message.toLowerCase();
            let response = '';
            let quickReplies = [];

            if (lowerMessage.includes('ç ”ç©¶æ‰€') || lowerMessage.includes('å­¸æ ¡') || lowerMessage.includes('ç§‘ç³»')) {
                currentMode = 'grad';
                response = handleGradQuery(message);
                quickReplies = [
                    'å­¸æ ¡ç†±é–€æ’å',
                    'ç§‘ç³»åˆ†æ',
                    'è©±é¡Œåˆ†å¸ƒ',
                    'è¿”å›ä¸»é¸å–®'
                ];
            } else if (lowerMessage.includes('ç¾é£Ÿ') || lowerMessage.includes('èœç³»') || lowerMessage.includes('é¤å»³')) {
                currentMode = 'food';
                response = handleFoodQuery(message);
                quickReplies = [
                    'èœç³»æ’è¡Œæ¦œ',
                    'é¤å»³é¡å‹',
                    'ç†±é–€èœè‰²',
                    'è¿”å›ä¸»é¸å–®'
                ];
            } else if (lowerMessage.includes('æ™¯é»') || lowerMessage.includes('æ—…éŠ') || lowerMessage.includes('è§€å…‰')) {
                currentMode = 'spot';
                response = handleSpotQuery(message);
                quickReplies = [
                    'ç†±é–€æ™¯é»æ’è¡Œ',
                    'æ™¯é»é¡å‹åˆ†æ',
                    'åœ°å€åˆ†å¸ƒ',
                    'è¿”å›ä¸»é¸å–®'
                ];
            } else if (lowerMessage.includes('ç†±é–€åœ°é»') || lowerMessage.includes('åœ°é»æ’è¡Œ')) {
                currentMode = 'spot';
                response = showSpotRanking();
                quickReplies = [
                    'æ™¯é»é¡å‹åˆ†æ',
                    'åœ°å€åˆ†å¸ƒ',
                    'è¿”å›ä¸»é¸å–®'
                ];
            } else if (lowerMessage.includes('æ’å') || lowerMessage.includes('ç†±é–€')) {
                if (currentMode === 'grad') {
                    response = showSchoolRanking();
                } else if (currentMode === 'food') {
                    response = showCuisineRanking();
                } else if (currentMode === 'spot') {
                    response = showSpotRanking();
                } else {
                    response = 'è«‹å…ˆé¸æ“‡æ‚¨æƒ³æŸ¥è©¢çš„ä¸»é¡Œï¼šç ”ç©¶æ‰€åˆ†æ ã€ ç¾é£Ÿåˆ†æã€æ™¯é»åˆ†æ';
                    quickReplies = ['ç ”ç©¶æ‰€åˆ†æ', 'ç¾é£Ÿåˆ†æ', 'æ™¯é»åˆ†æ'];
                }
            } else if (lowerMessage.includes('ä¸»é¸å–®') || lowerMessage.includes('è¿”å›')) {
                currentMode = 'welcome';
                response = 'ğŸ‘‹ æ­¡è¿å›åˆ°ä¸»é¸å–®ï¼è«‹é¸æ“‡æ‚¨æ„Ÿèˆˆè¶£çš„ä¸»é¡Œï¼š';
                quickReplies = ['ç ”ç©¶æ‰€åˆ†æ', 'ç¾é£Ÿåˆ†æ', 'æ™¯é»åˆ†æ', 'å­¸æ ¡æ’å'];
            } else {
                response = 'æŠ±æ­‰ï¼Œæˆ‘ä¸å¤ªç†è§£æ‚¨çš„å•é¡Œã€‚æ‚¨å¯ä»¥è©¢å•é—œæ–¼ç ”ç©¶æ‰€æ•¸æ“šã€ç¾é£Ÿåˆ†ææˆ–æ™¯é»è³‡è¨Šã€‚';
                quickReplies = ['ç ”ç©¶æ‰€åˆ†æ', 'ç¾é£Ÿåˆ†æ', 'æ™¯é»åˆ†æ', 'å¹«åŠ©'];
            }

            const botMessage = addMessage(response, false);

            if (quickReplies.length > 0) {
                const quickRepliesDiv = document.createElement('div');
                quickRepliesDiv.className = 'quick-replies';

                quickReplies.forEach(reply => {
                    const replyBtn = document.createElement('div');
                    replyBtn.className = 'quick-reply';
                    replyBtn.textContent = reply;
                    replyBtn.onclick = () => sendMessage(reply);
                    quickRepliesDiv.appendChild(replyBtn);
                });

                botMessage.appendChild(quickRepliesDiv);
            }

            updateStats();
        }

        // æ·»åŠ æ™¯é»æŸ¥è©¢è™•ç†å‡½æ•¸
        function handleSpotQuery(message) {
            const lowerMessage = message.toLowerCase();

            if (lowerMessage.includes('æ™¯é»') || lowerMessage.includes('æ’è¡Œ')) {
                return showSpotRanking();
            } else if (lowerMessage.includes('é¡å‹')) {
                return showSpotTypeAnalysis();
            } else if (lowerMessage.includes('åœ°å€')) {
                return showAreaAnalysis();
            } else {
                // æª¢æŸ¥spotTrendsæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ä½¿ç”¨é è¨­æ•¸æ“š
                if (typeof spotTrends === 'undefined') {
                    return 'ğŸï¸ æ™¯é»åˆ†æ\n\nç›®å‰ç„¡æ³•è¼‰å…¥æ™¯é»æ•¸æ“šï¼Œè«‹æª¢æŸ¥ data.js æª”æ¡ˆã€‚';
                }

                return `ğŸï¸ æ™¯é»åˆ†æ\n\nç›®å‰è³‡æ–™åº«åŒ…å«ï¼š\nâ€¢ ${spotTrends.spots.length} å€‹ç†±é–€æ™¯é»\nâ€¢ ${spotTrends.spot_types.length} ç¨®æ™¯é»é¡å‹\nâ€¢ ${spotTrends.total_articles} ç¯‡æ—…éŠæ–‡ç« \n\nè«‹å•æ‚¨æƒ³äº†è§£ä»€éº¼ï¼Ÿ`;
            }
        }

        // é¡¯ç¤ºæ™¯é»æ’å
        function showSpotRanking() {
            // å¦‚æœspotTrendsä¸å­˜åœ¨ï¼Œä½¿ç”¨é è¨­æ•¸æ“š
            if (typeof spotTrends === 'undefined') {
                return 'æ™¯é»æ•¸æ“šæš«ä¸å¯ç”¨ï¼Œè«‹æª¢æŸ¥ data.js æª”æ¡ˆã€‚';
            }

            const topSpots = spotTrends.spots.slice(0, 8);
            let response = 'ğŸï¸ ç†±é–€æ—…éŠåœ°é»æ’è¡Œï¼š\n\n';

            topSpots.forEach((spot, index) => {
                const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', '4ï¸âƒ£', '5ï¸âƒ£', '6ï¸âƒ£', '7ï¸âƒ£', '8ï¸âƒ£'];
                response += `${medals[index]} ${spot.name} (${spot.area}) - ${spot.count} æ¬¡æåŠ\n`;
            });

            response += `\nğŸ“Š ç¸½è¨ˆ ${spotTrends.total_articles} ç¯‡æ—…éŠç›¸é—œæ–‡ç« `;

            updateChart('spot');
            return response;
        }

        // é¡¯ç¤ºæ™¯é»é¡å‹åˆ†æ
        function showSpotTypeAnalysis() {
            if (typeof spotTrends === 'undefined' || !spotTrends.spot_types) {
                return 'æ™¯é»æ•¸æ“šæš«ä¸å¯ç”¨';
            }

            updateChart('spot_type');
            
            let response = 'ğŸ“Š æ—…éŠé¡å‹åˆ†æï¼š\n\n';
            spotTrends.spot_types.forEach(type => {
                response += `â€¢ ${type.name}: ${type.count} æ¬¡æåŠ\n`;
            });
            
            return response;
        }

        // é¡¯ç¤ºåœ°å€åˆ†å¸ƒåˆ†æ
        function showAreaAnalysis() {
            if (typeof spotTrends === 'undefined' || !spotTrends.areas) {
                return 'æ™¯é»æ•¸æ“šæš«ä¸å¯ç”¨';
            }

            updateChart('area');
            
            let response = 'ğŸ—ºï¸ åœ°å€åˆ†å¸ƒåˆ†æï¼š\n\n';
            spotTrends.areas.forEach(area => {
                response += `â€¢ ${area.name}: ${area.count} æ¬¡æåŠ\n`;
            });
            
            return response;
        }

        // è™•ç†ç ”ç©¶æ‰€ç›¸é—œæŸ¥è©¢
        function handleGradQuery(message) {
            const lowerMessage = message.toLowerCase();

            if (lowerMessage.includes('å­¸æ ¡') || lowerMessage.includes('æ’å')) {
                return showSchoolRanking();
            } else if (lowerMessage.includes('ç§‘ç³»')) {
                return showDepartmentAnalysis();
            } else if (lowerMessage.includes('è©±é¡Œ')) {
                return showTopicAnalysis();
            } else {
                if (typeof gradTrends === 'undefined') {
                    return 'ğŸ“ ç ”ç©¶æ‰€æ•¸æ“šåˆ†æ\n\nç›®å‰ç„¡æ³•è¼‰å…¥ç ”ç©¶æ‰€æ•¸æ“šï¼Œè«‹ç¨å¾Œå†è©¦ã€‚';
                }

                return `ğŸ“ ç ”ç©¶æ‰€æ•¸æ“šåˆ†æ\n\nç›®å‰è³‡æ–™åº«åŒ…å«ï¼š\nâ€¢ ${gradTrends.schools.length} æ‰€ç†±é–€å­¸æ ¡\nâ€¢ ${gradTrends.departments.length} å€‹ç†±é–€ç§‘ç³»\nâ€¢ ${gradTrends.total_articles} ç¯‡åˆ†ææ–‡ç« \n\nè«‹å•æ‚¨æƒ³äº†è§£ä»€éº¼ï¼Ÿ`;
            }
        }

        // è™•ç†ç¾é£Ÿç›¸é—œæŸ¥è©¢
        function handleFoodQuery(message) {
            const lowerMessage = message.toLowerCase();

            if (lowerMessage.includes('èœç³»')) {
                return showCuisineRanking();
            } else if (lowerMessage.includes('é¤å»³')) {
                return showRestaurantAnalysis();
            } else if (lowerMessage.includes('èœè‰²')) {
                return showDishesAnalysis();
            } else {
                if (typeof foodTrends === 'undefined') {
                    return 'ğŸœ ç¾é£Ÿè¶¨å‹¢åˆ†æ\n\nç›®å‰ç„¡æ³•è¼‰å…¥ç¾é£Ÿæ•¸æ“šï¼Œè«‹ç¨å¾Œå†è©¦ã€‚';
                }

                return `ğŸœ ç¾é£Ÿè¶¨å‹¢åˆ†æ\n\nç›®å‰è³‡æ–™åº«åŒ…å«ï¼š\nâ€¢ ${foodTrends.cuisines.length} ç¨®ç†±é–€èœç³»\nâ€¢ ${foodTrends.food_types.length} ç¨®é¤å»³é¡å‹\nâ€¢ ${foodTrends.total_articles} ç¯‡ç¾é£Ÿæ–‡ç« \n\nè«‹å•æ‚¨æƒ³äº†è§£ä»€éº¼ï¼Ÿ`;
            }
        }

        // é¡¯ç¤ºå­¸æ ¡æ’å
        function showSchoolRanking() {
            if (typeof gradTrends === 'undefined' || !gradTrends.schools) {
                return 'ç ”ç©¶æ‰€æ•¸æ“šæš«ä¸å¯ç”¨';
            }

            const topSchools = gradTrends.schools.slice(0, 5);
            let response = 'ğŸ« å­¸æ ¡ç†±é–€æ’å TOP 5ï¼š\n\n';

            topSchools.forEach((school, index) => {
                const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', '4ï¸âƒ£', '5ï¸âƒ£'];
                response += `${medals[index]} ${school.name} - ${school.count} æ¬¡æåŠ\n`;
            });

            updateChart('school');
            return response;
        }

        // é¡¯ç¤ºç§‘ç³»åˆ†æ
        function showDepartmentAnalysis() {
            if (typeof gradTrends === 'undefined' || !gradTrends.departments) {
                return 'ç ”ç©¶æ‰€æ•¸æ“šæš«ä¸å¯ç”¨';
            }

            const topDepartments = gradTrends.departments.slice(0, 5);
            let response = 'ğŸ“š ç†±é–€ç§‘ç³»åˆ†æ TOP 5ï¼š\n\n';

            topDepartments.forEach((dept, index) => {
                response += `${index + 1}. ${dept.name} - ${dept.count} æ¬¡æåŠ\n`;
            });

            updateChart('department');
            return response;
        }

        // é¡¯ç¤ºè©±é¡Œåˆ†æ
        function showTopicAnalysis() {
            if (typeof gradTrends === 'undefined' || !gradTrends.topics) {
                return 'ç ”ç©¶æ‰€æ•¸æ“šæš«ä¸å¯ç”¨';
            }

            updateChart('topic');
            return 'ğŸ“Š è©±é¡Œåˆ†å¸ƒåˆ†æå·²æ›´æ–°åœ¨å³å´åœ–è¡¨ä¸­ï¼\nä¸»è¦è¨è«–è©±é¡ŒåŒ…æ‹¬ï¼šè€ƒè©¦æº–å‚™ã€ç ”ç©¶æ‰€ç”Ÿæ´»ã€å°±æ¥­å‰æ™¯ç­‰ã€‚';
        }

        // é¡¯ç¤ºèœç³»æ’å
        function showCuisineRanking() {
            if (typeof foodTrends === 'undefined' || !foodTrends.cuisines) {
                return 'ç¾é£Ÿæ•¸æ“šæš«ä¸å¯ç”¨';
            }

            const topCuisines = foodTrends.cuisines.slice(0, 5);
            let response = 'ğŸ½ï¸ ç†±é–€èœç³»æ’å TOP 5ï¼š\n\n';

            topCuisines.forEach((cuisine, index) => {
                const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', '4ï¸âƒ£', '5ï¸âƒ£'];
                response += `${medals[index]} ${cuisine.name} - ${cuisine.count} æ¬¡æåŠ\n`;
            });

            updateChart('cuisine');
            return response;
        }

        // é¡¯ç¤ºé¤å»³åˆ†æ
        function showRestaurantAnalysis() {
            if (typeof foodTrends === 'undefined' || !foodTrends.food_types) {
                return 'ç¾é£Ÿæ•¸æ“šæš«ä¸å¯ç”¨';
            }

            updateChart('restaurant');
            return 'ğŸª é¤å»³é¡å‹åˆ†æå·²æ›´æ–°åœ¨å³å´åœ–è¡¨ä¸­ï¼\nåŒ…å«å„ç¨®é¤å»³é¡å‹çš„ç†±åº¦åˆ†å¸ƒã€‚';
        }

        // é¡¯ç¤ºèœè‰²åˆ†æ
        function showDishesAnalysis() {
            if (typeof foodTrends === 'undefined' || !foodTrends.dishes) {
                return 'ç¾é£Ÿæ•¸æ“šæš«ä¸å¯ç”¨';
            }

            updateChart('dishes');
            return 'ğŸ´ ç†±é–€èœè‰²åˆ†æå·²æ›´æ–°åœ¨å³å´åœ–è¡¨ä¸­ï¼\né¡¯ç¤ºæœ€å—æ­¡è¿çš„èœè‰²ç¨®é¡ã€‚';
        }

        // æ›´æ–°åœ–è¡¨
        function updateChart(type) {
            const ctx = document.getElementById('mainChart').getContext('2d');

            if (currentChart) {
                currentChart.destroy();
            }

            let chartData = {};

            switch (type) {
                case 'school':
                    chartData = createSchoolChartData();
                    break;
                case 'department':
                    chartData = createDepartmentChartData();
                    break;
                case 'topic':
                    chartData = createTopicChartData();
                    break;
                case 'cuisine':
                    chartData = createCuisineChartData();
                    break;
                case 'restaurant':
                    chartData = createRestaurantChartData();
                    break;
                case 'dishes':
                    chartData = createDishesChartData();
                    break;
                case 'spot':
                    chartData = createSpotChartData();
                    break;
                case 'spot_type':
                    chartData = createSpotTypeChartData();
                    break;
                case 'area':
                    chartData = createAreaChartData();
                    break;
                default:
                    chartData = createWelcomeChartData();
            }

            currentChart = new Chart(ctx, chartData);
        }

        // å‰µå»ºå­¸æ ¡åœ–è¡¨æ•¸æ“š
        function createSchoolChartData() {
            const schools = (typeof gradTrends !== 'undefined' && gradTrends.schools)
                ? gradTrends.schools.slice(0, 8)
                : [
                    { name: 'å°å¤§', count: 120 },
                    { name: 'æ¸…å¤§', count: 95 },
                    { name: 'äº¤å¤§', count: 90 },
                    { name: 'æˆå¤§', count: 85 },
                    { name: 'æ”¿å¤§', count: 75 },
                    { name: 'å¸«å¤§', count: 65 },
                    { name: 'ä¸­å¤®', count: 60 },
                    { name: 'ä¸­å±±', count: 55 }
                ];

            return {
                type: 'bar',
                data: {
                    labels: schools.map(s => s.name),
                    datasets: [{
                        label: 'è¨è«–ç†±åº¦',
                        data: schools.map(s => s.count),
                        backgroundColor: 'rgba(0, 242, 254, 0.8)',
                        borderColor: '#00f2fe',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e2e8f0'
                            }
                        },
                        title: {
                            display: true,
                            text: 'å­¸æ ¡è¨è«–ç†±åº¦æ’è¡Œ',
                            color: '#e2e8f0'
                        }
                    },
                    scales: {
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    }
                }
            };
        }

        // å‰µå»ºèœç³»åœ–è¡¨æ•¸æ“š
        function createCuisineChartData() {
            const cuisines = (typeof foodTrends !== 'undefined' && foodTrends.cuisines)
                ? foodTrends.cuisines.slice(0, 8)
                : [
                    { name: 'ä¸­å¼', count: 150 },
                    { name: 'æ—¥å¼', count: 130 },
                    { name: 'éŸ“å¼', count: 110 },
                    { name: 'ç¾å¼', count: 90 },
                    { name: 'ç¾©å¼', count: 85 },
                    { name: 'æ³°å¼', count: 70 },
                    { name: 'æ³•å¼', count: 60 },
                    { name: 'å°å¼', count: 200 }
                ];

            return {
                type: 'doughnut',
                data: {
                    labels: cuisines.map(c => c.name),
                    datasets: [{
                        data: cuisines.map(c => c.count),
                        backgroundColor: [
                            'rgba(0, 242, 254, 0.8)',
                            'rgba(79, 172, 254, 0.8)',
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(199, 0, 255, 0.8)',
                            'rgba(255, 64, 129, 0.8)',
                            'rgba(0, 255, 136, 0.8)',
                            'rgba(255, 221, 0, 0.8)',
                            'rgba(255, 119, 0, 0.8)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: '#e2e8f0'
                            }
                        },
                        title: {
                            display: true,
                            text: 'èœç³»ç†±åº¦åˆ†å¸ƒ',
                            color: '#e2e8f0'
                        }
                    }
                }
            };
        }

        // å‰µå»ºæ™¯é»åœ–è¡¨æ•¸æ“š
        function createSpotChartData() {
            const spots = (typeof spotTrends !== 'undefined' && spotTrends.spots)
                ? spotTrends.spots.slice(0, 8)
                : [
                    { name: 'å°åŒ—101', count: 150 },
                    { name: 'ä¹ä»½è€è¡—', count: 130 },
                    { name: 'æ—¥æœˆæ½­', count: 120 },
                    { name: 'é˜¿é‡Œå±±', count: 110 },
                    { name: 'å¢¾ä¸', count: 100 },
                    { name: 'å¤ªé­¯é–£', count: 95 },
                    { name: 'æ•…å®®', count: 90 },
                    { name: 'è¥¿é–€ç”º', count: 85 }
                ];

            return {
                type: 'bar',
                data: {
                    labels: spots.map(s => s.name),
                    datasets: [{
                        label: 'è¨è«–ç†±åº¦',
                        data: spots.map(s => s.count),
                        backgroundColor: 'rgba(0, 255, 136, 0.8)',
                        borderColor: '#00ff88',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e2e8f0'
                            }
                        },
                        title: {
                            display: true,
                            text: 'æ™¯é»è¨è«–ç†±åº¦æ’è¡Œ',
                            color: '#e2e8f0'
                        }
                    },
                    scales: {
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8',
                                maxRotation: 45
                            }
                        }
                    }
                }
            };
        }

        // å‰µå»ºæ™¯é»é¡å‹åœ–è¡¨æ•¸æ“š
        function createSpotTypeChartData() {
            const spotTypes = (typeof spotTrends !== 'undefined' && spotTrends.spot_types)
                ? spotTrends.spot_types
                : [
                    { name: 'è‡ªç„¶æ™¯è§€', count: 450 },
                    { name: 'åŸå¸‚åœ°æ¨™', count: 380 },
                    { name: 'æ–‡åŒ–å¤è¹Ÿ', count: 320 },
                    { name: 'ä¸»é¡Œæ¨‚åœ’', count: 280 },
                    { name: 'è³¼ç‰©å•†åœˆ', count: 250 }
                ];

            return {
                type: 'pie',
                data: {
                    labels: spotTypes.map(t => t.name),
                    datasets: [{
                        data: spotTypes.map(t => t.count),
                        backgroundColor: [
                            'rgba(0, 255, 136, 0.8)',
                            'rgba(0, 242, 254, 0.8)',
                            'rgba(79, 172, 254, 0.8)',
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(199, 0, 255, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: '#e2e8f0'
                            }
                        },
                        title: {
                            display: true,
                            text: 'æ™¯é»é¡å‹åˆ†å¸ƒ',
                            color: '#e2e8f0'
                        }
                    }
                }
            };
        }

        // å‰µå»ºåœ°å€åˆ†å¸ƒåœ–è¡¨æ•¸æ“š
        function createAreaChartData() {
            const areas = (typeof spotTrends !== 'undefined' && spotTrends.areas)
                ? spotTrends.areas
                : [
                    { name: 'å°åŒ—', count: 350 },
                    { name: 'æ–°åŒ—', count: 300 },
                    { name: 'å°ä¸­', count: 280 },
                    { name: 'é«˜é›„', count: 220 },
                    { name: 'èŠ±è“®', count: 180 }
                ];

            return {
                type: 'doughnut',
                data: {
                    labels: areas.map(a => a.name),
                    datasets: [{
                        data: areas.map(a => a.count),
                        backgroundColor: [
                            'rgba(0, 255, 136, 0.8)',
                            'rgba(0, 242, 254, 0.8)',
                            'rgba(79, 172, 254, 0.8)',
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(199, 0, 255, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: '#e2e8f0'
                            }
                        },
                        title: {
                            display: true,
                            text: 'åœ°å€æ™¯é»åˆ†å¸ƒ',
                            color: '#e2e8f0'
                        }
                    }
                }
            };
        }

        // å‰µå»ºå…¶ä»–åœ–è¡¨æ•¸æ“šçš„å‡½æ•¸ï¼ˆéƒ¨é–€ã€è©±é¡Œã€é¤å»³ã€èœè‰²ï¼‰
        function createDepartmentChartData() {
            const departments = (typeof gradTrends !== 'undefined' && gradTrends.departments)
                ? gradTrends.departments.slice(0, 6)
                : [
                    { name: 'è³‡å·¥', count: 120 },
                    { name: 'é›»æ©Ÿ', count: 110 },
                    { name: 'ä¼ç®¡', count: 95 },
                    { name: 'æ³•å¾‹', count: 85 },
                    { name: 'é†«å­¸', count: 80 },
                    { name: 'è¨­è¨ˆ', count: 75 }
                ];

            return {
                type: 'bar',
                data: {
                    labels: departments.map(d => d.name),
                    datasets: [{
                        label: 'è¨è«–æ¬¡æ•¸',
                        data: departments.map(d => d.count),
                        backgroundColor: 'rgba(79, 172, 254, 0.8)',
                        borderColor: '#4facfe',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e2e8f0'
                            }
                        },
                        title: {
                            display: true,
                            text: 'ç§‘ç³»è¨è«–ç†±åº¦',
                            color: '#e2e8f0'
                        }
                    },
                    scales: {
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    }
                }
            };
        }

        function createTopicChartData() {
            const topics = (typeof gradTrends !== 'undefined' && gradTrends.topics)
                ? gradTrends.topics
                : [
                    { name: 'è€ƒè©¦æº–å‚™', count: 150 },
                    { name: 'ç ”ç©¶æ‰€ç”Ÿæ´»', count: 120 },
                    { name: 'å°±æ¥­å‰æ™¯', count: 100 },
                    { name: 'ç ”ç©¶é ˜åŸŸ', count: 80 }
                ];

            return {
                type: 'pie',
                data: {
                    labels: topics.map(t => t.name),
                    datasets: [{
                        data: topics.map(t => t.count),
                        backgroundColor: [
                            'rgba(0, 242, 254, 0.8)',
                            'rgba(79, 172, 254, 0.8)',
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(199, 0, 255, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: '#e2e8f0'
                            }
                        },
                        title: {
                            display: true,
                            text: 'è©±é¡Œåˆ†å¸ƒ',
                            color: '#e2e8f0'
                        }
                    }
                }
            };
        }

        function createRestaurantChartData() {
            const restaurants = (typeof foodTrends !== 'undefined' && foodTrends.food_types)
                ? foodTrends.food_types.slice(0, 6)
                : [
                    { name: 'é€Ÿé£Ÿ', count: 120 },
                    { name: 'å°åƒ', count: 150 },
                    { name: 'é¤å»³', count: 100 },
                    { name: 'å’–å•¡å»³', count: 90 },
                    { name: 'å¤œå¸‚', count: 110 },
                    { name: 'æ—©é¤åº—', count: 95 }
                ];

            return {
                type: 'bar',
                data: {
                    labels: restaurants.map(r => r.name),
                    datasets: [{
                        label: 'æåŠæ¬¡æ•¸',
                        data: restaurants.map(r => r.count),
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: '#667eea',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e2e8f0'
                            }
                        },
                        title: {
                            display: true,
                            text: 'é¤å»³é¡å‹ç†±åº¦',
                            color: '#e2e8f0'
                        }
                    },
                    scales: {
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    }
                }
            };
        }

        function createDishesChartData() {
            const dishes = (typeof foodTrends !== 'undefined' && foodTrends.dishes)
                ? foodTrends.dishes.slice(0, 6)
                : [
                    { name: 'ç‰›è‚‰éºµ', count: 120 },
                    { name: 'æ»·è‚‰é£¯', count: 150 },
                    { name: 'é›æ’', count: 110 },
                    { name: 'çç å¥¶èŒ¶', count: 130 },
                    { name: 'å°ç± åŒ…', count: 90 },
                    { name: 'è‡­è±†è…', count: 80 }
                ];

            return {
                type: 'pie',
                data: {
                    labels: dishes.map(d => d.name),
                    datasets: [{
                        data: dishes.map(d => d.count),
                        backgroundColor: [
                            'rgba(255, 64, 129, 0.8)',
                            'rgba(0, 255, 136, 0.8)',
                            'rgba(255, 221, 0, 0.8)',
                            'rgba(255, 119, 0, 0.8)',
                            'rgba(199, 0, 255, 0.8)',
                            'rgba(0, 242, 254, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: '#e2e8f0'
                            }
                        },
                        title: {
                            display: true,
                            text: 'ç†±é–€èœè‰²åˆ†å¸ƒ',
                            color: '#e2e8f0'
                        }
                    }
                }
            };
        }

        function createWelcomeChartData() {
            const gradArticles = (typeof gradTrends !== 'undefined' && gradTrends.total_articles)
                ? gradTrends.total_articles
                : 500;
            const foodArticles = (typeof foodTrends !== 'undefined' && foodTrends.total_articles)
                ? foodTrends.total_articles
                : 450;
            const spotArticles = (typeof spotTrends !== 'undefined' && spotTrends.total_articles)
                ? spotTrends.total_articles
                : 300;

            return {
                type: 'doughnut',
                data: {
                    labels: ['ç ”ç©¶æ‰€æ•¸æ“š', 'ç¾é£Ÿåˆ†æ', 'æ™¯é»åˆ†æ'],
                    datasets: [{
                        data: [gradArticles, foodArticles, spotArticles],
                        backgroundColor: [
                            'rgba(0, 242, 254, 0.8)',
                            'rgba(79, 172, 254, 0.8)',
                            'rgba(0, 255, 136, 0.8)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e2e8f0'
                            }
                        },
                        title: {
                            display: true,
                            text: 'æ•¸æ“šåˆ†å¸ƒæ¦‚è¦½',
                            color: '#e2e8f0'
                        }
                    }
                }
            };
        }

        // æ›´æ–°çµ±è¨ˆæ•¸æ“š
        function updateStats() {
            document.getElementById('totalSchools').textContent =
                (typeof gradTrends !== 'undefined' && gradTrends.schools) ? gradTrends.schools.length : 8;
            document.getElementById('totalCuisines').textContent =
                (typeof foodTrends !== 'undefined' && foodTrends.cuisines) ? foodTrends.cuisines.length : 8;

            const gradArticles = (typeof gradTrends !== 'undefined' && gradTrends.total_articles)
                ? gradTrends.total_articles
                : 500;
            const foodArticles = (typeof foodTrends !== 'undefined' && foodTrends.total_articles)
                ? foodTrends.total_articles
                : 450;
            const spotArticles = (typeof spotTrends !== 'undefined' && spotTrends.total_articles)
                ? spotTrends.total_articles
                : 300;

            document.getElementById('totalArticles').textContent = gradArticles + foodArticles + spotArticles;
            document.getElementById('totalDepartments').textContent =
                (typeof gradTrends !== 'undefined' && gradTrends.departments) ? gradTrends.departments.length : 6;
        }

        // åˆå§‹åŒ–é é¢
        function initializePage() {
            console.log('åˆå§‹åŒ–é é¢...');

            // æª¢æŸ¥æ•¸æ“šæ˜¯å¦åŠ è¼‰å®Œæˆ
            console.log('gradTrends:', typeof gradTrends !== 'undefined' ? 'å·²åŠ è¼‰' : 'æœªåŠ è¼‰');
            console.log('foodTrends:', typeof foodTrends !== 'undefined' ? 'å·²åŠ è¼‰' : 'æœªåŠ è¼‰');
            console.log('spotTrends:', typeof spotTrends !== 'undefined' ? 'å·²åŠ è¼‰' : 'æœªåŠ è¼‰');

            // å¦‚æœ spotTrends æœªåŠ è¼‰ï¼Œé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
            if (typeof spotTrends === 'undefined') {
                console.error('spotTrends æœªåŠ è¼‰ï¼Œè«‹æª¢æŸ¥ data.js æª”æ¡ˆ');
                showNotification('æ—…éŠæ•¸æ“šè¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ data.js æª”æ¡ˆ');

                // å‰µå»ºä¸€å€‹ç©ºçš„ spotTrends é¿å…ç¨‹å¼éŒ¯èª¤
                window.spotTrends = {
                    spots: [],
                    spot_types: [],
                    areas: [],
                    total_articles: 0
                };
            } else {
                console.log('æ—…éŠæ•¸æ“šæˆåŠŸè¼‰å…¥:', spotTrends);
                showNotification('ç³»çµ±åˆå§‹åŒ–å®Œæˆï¼æ—…éŠæ•¸æ“šå·²è¼‰å…¥');
            }

            // æ›´æ–°çµ±è¨ˆæ•¸æ“š
            updateStats();

            // åˆå§‹åŒ–æ­¡è¿åœ–è¡¨
            updateChart('welcome');
        }

        // é é¢åŠ è¼‰å®Œæˆå¾Œåˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>

</html>